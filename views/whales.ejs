<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Whales</title>
  
  <!-- Fonts & Bootstrap -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/featuredstyle.css">

  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

  <style>
    body {
      margin: 0;
      /* background-color: rgb(188, 174, 146); */
      background-color: black;
    }
    canvas {
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <!-- Bootstrap Header -->
  <header>
    <%- include('header'); %>
  </header>

  <!-- Main content with p5 canvas -->
  <main>
    <div class="spacer"></div>
    <div class="display-5 text-center text-white">Whales</div>
  </main>

  <!-- p5 sketch -->
  <script>
    let whale1, whale2, whale3;
    const scale = 0.4;
    let bubbleSystems = [];

    function preload() {
      whale1 = loadImage("/images/whale1.png");
      whale2 = loadImage("/images/whale2.png");
      whale3 = loadImage("/images/whale3.png");
    }

    function setup() {
      createCanvas(1500, 600);
      imageMode(CORNER);

      const sw = whale1.width * scale;
      const sh = whale1.height * scale;

      const whalePositions = [
        { x: 50, y: 175 },
        { x: 400, y: 290 },
        { x: 800, y: 175 }
      ];

      whalePositions.forEach((pos, i) => {
        let emitterX = pos.x + sw / 2;
        let emitterY = pos.y - 10;
        bubbleSystems.push(new BubbleSystem(emitterX, emitterY));
      });

      bubbleSystems[1].origin.x += 40; bubbleSystems[1].origin.y += 130;
      bubbleSystems[2].origin.x -= 40; bubbleSystems[2].origin.y += 95;
      bubbleSystems[0].origin.x -= 50; bubbleSystems[0].origin.y += 90;
    }

    function draw() {
      // background(188, 174, 146);
      background(0);

      const sw = whale1.width * scale;
      const sh = whale1.height * scale;

      // Draw whales
      image(whale1, 50, 175, sw, sh);
      image(whale2, 400, 290, sw, sh);
      image(whale3, 800, 175, sw, sh);

      // Draw bubble systems
      for (let system of bubbleSystems) {
        system.addBubble();
        system.update();
      }
    }

    class Bubble {
      constructor(x, y) {
        this.pos = createVector(x, y);
        this.vel = createVector(random(-0.5, 0.5), random(-2, -1));
        this.lifetime = 255;
        this.size = random(5, 10);
        this.gray = random(100, 255);
      }
      update() { this.pos.add(this.vel); this.lifetime -= 2; }
      display() { noStroke(); fill(this.gray, this.lifetime); ellipse(this.pos.x, this.pos.y, this.size); }
      isDead() { return this.lifetime <= 0; }
    }

    class BubbleSystem {
      constructor(x, y) { this.origin = createVector(x, y); this.bubbles = []; }
      addBubble() { this.bubbles.push(new Bubble(this.origin.x + random(-20,20), this.origin.y)); }
      update() {
        for (let i=this.bubbles.length-1;i>=0;i--){
          let b=this.bubbles[i]; b.update(); b.display();
          if(b.isDead()) this.bubbles.splice(i,1);
        }
      }
    }
  </script>

  <!-- Bootstrap Footer -->
  <footer class="container-fluid">
    <%- include('footer'); %>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
